USE master;

GO
ALTER DATABASE PADELTADB
SET
	SINGLE_USER
WITH
	ROLLBACK IMMEDIATE;

GO
DROP DATABASE PADELTADB;

CREATE DATABASE PADELTADB
GO

USE PADELTADB

CREATE TABLE Usuarios(
Id uniqueidentifier PRIMARY KEY not null DEFAULT NEWID(),
Username VARCHAR(30) UNIQUE NOT NULL,
Nombre NVARCHAR(30),
Apellido1 NVARCHAR(30),
Apellido2 NVARCHAR(30),
Correo VARCHAR(80) UNIQUE NOT NULL,
Contrasena VARCHAR(30)
);

CREATE TABLE Productos(
Id uniqueidentifier PRIMARY KEY not null DEFAULT NEWID(),
Name NVARCHAR(50) NOT NULL,
Description VARCHAR(255),
Price DECIMAL(10, 2) NOT NULL,
Discount INT,
Category VARCHAR(30),
Active BIT NOT NULL,
Stock INT NOT NULL,
CreatedAt DATETIME DEFAULT GETDATE(),
);

CREATE TABLE Imagen(
Id UNIQUEIDENTIFIER PRIMARY KEY not null DEFAULT NEWID(),
ProductoId UNIQUEIDENTIFIER NOT NULL,
Name VARCHAR(100) NOT NULL,
FOREIGN KEY (ProductoId) REFERENCES Productos(Id)
);

CREATE TABLE Carrito(
Id UNIQUEIDENTIFIER PRIMARY KEY not null DEFAULT NEWID(),
UserId UNIQUEIDENTIFIER NOT NULL,
Estado VARCHAR(15) DEFAULT 'Pendiente' CHECK (Estado in ('Pendiente', 'Pagado')),
FOREIGN KEY (UserId) REFERENCES Usuarios(Id)
);

CREATE TABLE ProductosPorCarrito(
CarritoId UNIQUEIDENTIFIER NOT NULL,
ProductoId UNIQUEIDENTIFIER NOT NULL,
Cantidad INT NOT NULL,
Impuestos DECIMAL(10, 2) DEFAULT 0,
FOREIGN KEY (CarritoId) REFERENCES Carrito(Id),
FOREIGN KEY (ProductoId) REFERENCES Productos(Id)
);

CREATE TABLE Ordenes(
Id UNIQUEIDENTIFIER PRIMARY KEY not null DEFAULT NEWID(),
CarritoId UNIQUEIDENTIFIER NOT NULL,
Estado VARCHAR(15) DEFAULT 'Pendiente',
Fecha DATETIME DEFAULT GETDATE(),
PrecioBruto DECIMAL(10, 2) NOT NULL,
PrecioNeto DECIMAL(10, 2) NOT NULL,
CHECK (Estado in ('Pendiente', 'Entregado', 'Cancelado')),
FOREIGN KEY (CarritoId) REFERENCES Carrito(Id)
);

